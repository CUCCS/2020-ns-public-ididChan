# Exp-0A åŸºäºfail2bançš„å®‰å…¨åŠ å›º

### 1. å®éªŒç›®çš„

- [x] äº†è§£å®‰å…¨åŠ å›ºçš„åŸºæœ¬åŸç†ä¸å®ç°æ–¹æ³•

### 2. å®éªŒè¦æ±‚

- [x] ä½¿ç”¨fail2banå®ç°SSHå®‰å…¨åŠ å›º

### 3. å®éªŒç¯å¢ƒ

- ç½‘ç»œæ‹“æ‰‘

    ![img](img/topo.PNG)

- ç½‘ç»œè¿é€šæ€§æ£€éªŒ

    ![img](img/1-to-2.PNG)

    ![img](img/2-to-1.PNG)

- èŠ‚ç‚¹ä¿¡æ¯æè¿°

    | è™šæ‹Ÿæœºåç§° |     ç½‘å¡é€‰æ‹©     |      IPåœ°å€       |      MACåœ°å€      |
    | :--------: | :--------------: | :---------------: | :---------------: |
    |  host-1  | NAT|   10.0.2.15/24    | 08:00:27:e7:bd:47 |
    |            |  Host-Onlyç½‘ç»œ   | 192.168.56.119/24 | 08:00:27:ba:da:4a |
    |  host-2  |     NAT      |  10.0.2.15/24   | 08:00:27:3e:89:dd |
    |            |  Host-Onlyç½‘ç»œ   | 192.168.56.120/24  | 08:00:27:b8:e0:5d |

- è½¯ä»¶ç¯å¢ƒ

    - fail2ban - 0.11.1-2
    
    - Hydra - 9.0-1

    - Medusa - v2.2

    - X-Hydra

    - Metasploit - 5.0.99-dev

    - Patator - 0.8

    - Ncrack - 0.7

### 4. å®éªŒè¿‡ç¨‹

- **ä½¿ç”¨SSHçš„æœåŠ¡ç«¯å£æš´åŠ›ç ´è§£host-1çš„ç™»é™†å¯†ç **

    **ã€ATTENTIONã€‘** æš´åŠ›ç ´è§£è½¯ä»¶çš„ç”¨æ³•å¾ˆå¤šï¼Œæœ¬å®éªŒå¯¹å•ä¸€è½¯ä»¶ä»…ä½¿ç”¨äº†æœ‰é™ç§æ–¹æ³•è¿›è¡Œçˆ†ç ´å°è¯•ï¼Œä¸”è¿›è¡Œçˆ†ç ´å°è¯•çš„æ•°æ®ä¹Ÿå¾ˆå°‘ï¼Œè¿™é‡Œé‡åœ¨ä½“éªŒè½¯ä»¶çš„ä½¿ç”¨æ–¹æ³•ï¼Œæ­£å¸¸æ“ä½œæ€è·¯åº”è¯¥æ˜¯åœ¨çˆ†ç ´æ—¶è¿æ¥æ•°æ®åº“ğŸ˜

    - **Hydra**

        ```
        hydra -L user_list -P password_list dest_IP ssh
        ```

        ![img](img/hydra.PNG)

    - **Medusa**

        ```
        medusa -h dest_IP -U user_list -P password_list -M ssh
        ```

        ![img](img/medusa.PNG)

        ã€ä¸ªäººä½¿ç”¨ä½“éªŒã€‘æ•°æ®é›†ç›¸åŒçš„æƒ…å†µä¸‹Medusaæ¯”Hydraæ…¢å¾ˆå¤šğŸ˜’ï¼Œè€Œä¸”è¾“å‡ºç•Œé¢æ˜¯çœŸçš„éš¾çœ‹

    - **X-Hydra** (GUI version of Hydra)

        æ ¹æ®åº”ç”¨éœ€æ±‚è®¾ç½®çˆ†ç ´æ–¹å¼ï¼š

        <img src="img/xhydra-target.PNG" alt="img" style="zoom:50%;" />

        <img src="img/xhydra-passwd.PNG" alt="img" style="zoom:50%;" />

        <img src="img/xhydra-ans.PNG" alt="img" style="zoom:50%;" />

    - **Metasploit**

        ```
        # è¿›å…¥Metasploitçš„äº¤äº’å¼ç•Œé¢
        msfconsole
        # æ ¹æ®åº”ç”¨éœ€æ±‚è®¾ç½®çˆ†ç ´é€‰é¡¹
        use auxiliary/scanner/ssh/ssh_login
        set rhosts dest_IP
        set user_file user_list
        set pass_file password_list
        run
        ```

        ![img](img/metasploit.PNG)

        ã€ä¸ªäººä½¿ç”¨ä½“éªŒã€‘Metasploitè™½ç„¶çˆ†ç ´é€Ÿåº¦ç¨å¾®æ…¢äº†ç‚¹ï¼Œä½†æ˜¯çˆ†ç ´å®Œæˆåæä¾›çš„è¿œç¨‹ç”¨æˆ·ä¿¡æ¯è¿˜æ˜¯éå¸¸å…¨é¢çš„ï¼Œè€Œä¸”æ¬¢è¿ç•Œé¢è®¾è®¡çš„ä¹Ÿéå¸¸å¥½çœ‹ï¼Œå–œæ¬¢å–œæ¬¢ğŸ‘»

    - **Patator**

        ```
        patator ssh_login host=dest_IP user=FILE0 0=user_list password=FILE1 1=password_list
        ```

        ![img](img/patator.PNG)

        ã€ä¸ªäººä½¿ç”¨ä½“éªŒã€‘è¾“å‡ºç•Œé¢çœ‹èµ·æ¥å¾ˆèˆ’é€‚ğŸ‘ï¼Œç›¸åŒæ•°æ®é›†ä¸‹é€Ÿåº¦ä¹Ÿå¾ˆOKï¼Œç”¨pythonå†™å°å·¥å…·è¿˜æ˜¯è›®ä¸é”™çš„

    - **Ncrack**

        ```
        ncrack -U user_list -P password_list dest_IP:SSH_port
        ```

        ![img](img/ncrack.PNG)

- **ä½¿ç”¨fail2banå¯¹SSHæœåŠ¡è¿›è¡Œå®‰å…¨åŠ å›º**

    - è®¾ç½®åŠ å›ºéœ€æ±‚

        ```
        # ä¸‹è½½fail2ban
        apt-get install fail2ban
        # å¯¹fail2banè¿›è¡Œä¸€äº›ç®€å•çš„é…ç½®
        vim /etc/fail2ban/jail.conf
        ```

        **/etc/fail2ban/jail.conf**
        ```
        # The length of time in seconds for which an IP is banned. If set to a negative number, the ban will be permanent.
        bantime = 60

        # The length of time between login attempts before a ban is set
        findtime = 60

        # How many attempts can be made to access the server from a single IP before a ban is imposed
        maxretry = 3
        ```

    - å®‰å…¨æ€§æ£€éªŒ

        - Hydra

            ![img](img/hydra-ban.PNG)

            ![img](img/hydra-ban-info.PNG)

        - Medusa

            é€šè¿‡å®éªŒå‘ç°ï¼Œå½“maxretryè®¾ç½®çš„å¾ˆå°çš„æ—¶å€™Medusaçš„å¯ç”¨æ€§éå¸¸ä½ï¼Œå†åŠ ä¸€ä¸ªbantimeå› å­çš„è¯åŸºæœ¬å°±åºŸäº†ï¼ˆéš¾é“æ˜¯å› ä¸ºæœ¬æ¥å°±æ…¢ï¼Ÿ

            ![img](img/medusa-ban.PNG)

            ![img](img/medusa-ban-info.PNG)

        - X-Hydra

            ![img](img/xhydra-ban.PNG)

            ![img](img/xhydra-ban-info.PNG)

        - Metasploit

            ![img](img/metasploit-ban.PNG)

            ![img](img/metasploit-ban-info.PNG)

        - Patator

            Patatoré€€å‡ºSSHè¿æ¥çš„ç”¨æ—¶ä¹Ÿå¾ˆé•¿ï¼Œå°½ç®¡åŒ¹é…åˆ°äº†æ­£ç¡®çš„ç”¨æˆ·åä¸å¯†ç ä½†è¿æ¥è¿˜æ˜¯å¤±è´¥

            ![img](img/patator-ban.PNG)

            ![img](img/patator-ban-info.PNG)

        - Ncrack

            ![img](img/ncrack-ban.PNG)

            ![img](img/ncrack-ban-info.PNG)



### 5. é‡åˆ°çš„é—®é¢˜

- å®‰è£…fail2banæ—¶å‡ºç°æŠ¥é”™ä¿¡æ¯å¦‚ä¸‹ï¼š

    ![img](img/p1.PNG)

    **é”™è¯¯åŸå› ï¼š** Debianä¸­ä¸‹è½½fail2banæ—¶æŸäº›å¿…éœ€çš„è½¯ä»¶åŒ…å°šæœªåˆ›å»ºæˆ–å·²ä»ä¼ å…¥åˆ—è¡¨ä¸­ç§»å‡º

    **è§£å†³æ–¹æ³•ï¼š** åœ¨Kaliä¸­å®‰è£…

    ![img](img/s1.PNG)

- **ã€Unsolvedã€‘** ä¸åŒçˆ†ç ´è½¯ä»¶åœ¨ host-2 çš„IPè¢«banæ—¶é€€å‡ºSSHè¿æ¥çš„ç”¨æ—¶ä¸åŒï¼Œä¸çŸ¥é“é€€å‡ºæ—¶é—´æ˜¯çŸ­ç‚¹å¥½è¿˜æ˜¯é•¿ç‚¹å¥½å‘¢ï¼Ÿ


### 6. å‚è€ƒèµ„æ–™

- [Password Cracking:SSH](https://www.hackingarticles.in/password-crackingssh/)

- [Using Fail2ban to Secure Your Server - A Tutorial](https://www.linode.com/docs/guides/using-fail2ban-to-secure-your-server-a-tutorial/)