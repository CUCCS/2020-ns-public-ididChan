# Exp-0B å¸¸è§èœœç½ä½“éªŒå’Œæ¢ç´¢

### 1. å®éªŒç›®çš„

- [x] äº†è§£èœœç½çš„åˆ†ç±»å’ŒåŸºæœ¬åŸç†

- [x] äº†è§£ä¸åŒç±»å‹èœœç½çš„é€‚ç”¨åœºåˆ

- [x] æŒæ¡å¸¸è§èœœç½çš„æ­å»ºå’Œä½¿ç”¨

### 2. å®éªŒè¦æ±‚

- [x] è®°å½•èœœç½çš„è¯¦ç»†æ­å»ºè¿‡ç¨‹

    - ä» [paralax/awesome-honeypots](https://github.com/paralax/awesome-honeypots) ä¸­é€‰æ‹© 1 ç§ä½äº¤äº’å‹èœœç½å’Œ 1 ç§ä¸­ç­‰äº¤äº’å‹èœœç½è¿›è¡Œæ­å»ºå®éªŒ

    - æ¨è SSH èœœç½

- [x] ä½¿ç”¨ nmap æ‰«ææ­å»ºå¥½çš„èœœç½å¹¶åˆ†ææ‰«æç»“æœï¼ŒåŒæ—¶åˆ†æã€Œ nmap æ‰«ææœŸé—´ã€èœœç½ä¸Šè®°å½•å¾—åˆ°çš„ä¿¡æ¯

- [x] å¦‚ä½•è¾¨åˆ«å½“å‰ç›®æ ‡æ˜¯ä¸€ä¸ªã€Œèœœç½ã€ï¼Ÿä»¥è‡ªå·±æ­å»ºçš„èœœç½ä¸ºä¾‹è¿›è¡Œè¯´æ˜

- [x] æ€»ç»“å¸¸è§çš„èœœç½è¯†åˆ«å’Œæ£€æµ‹æ–¹æ³•

- [ ] åŸºäº canarytokens æ­å»ºèœœä¿¡å®éªŒç¯å¢ƒè¿›è¡Œè‡ªç”±æ¢ç´¢å‹å®éªŒ

### 3. å®éªŒç¯å¢ƒ

- ç½‘ç»œæ‹“æ‰‘

    ![img](img/topo.PNG)

- èŠ‚ç‚¹ä¿¡æ¯æè¿°

    | è™šæ‹Ÿæœºåç§° |     ç½‘å¡é€‰æ‹©     |      IPåœ°å€       |      MACåœ°å€      |
    | :--------: | :--------------: | :---------------: | :---------------: |
    |  host-1  | NAT|   10.0.2.15/24    | 08:00:27:e7:bd:47 |
    |            |  Host-Onlyç½‘ç»œ   | 192.168.56.119/24 | 08:00:27:ba:da:4a |
    |  host-2  |     NAT      |  10.0.2.15/24   | 08:00:27:3e:89:dd |
    |            |  Host-Onlyç½‘ç»œ   | 192.168.56.120/24  | 08:00:27:b8:e0:5d |

- åŸºæœ¬ç½‘ç»œè¿é€šæ€§æ£€éªŒ

    ![img](img/1-to-2.PNG)

    ![img](img/2-to-1.PNG)

- è½¯ä»¶ç¯å¢ƒ

    - ä½äº¤äº’å‹èœœç½ï¼šSSH Honeypot

    - ä¸­ç­‰äº¤äº’å‹èœœç½ï¼šCowrie

### 4. å®éªŒå‡†å¤‡

- å®‰è£…dockerä¸docker-compose

    ```
    # å®‰è£…dockerä¸docker-compose
    apt-get update && apt get install docker.io python3-pip 
    pip3 install docker-compose
    ```


### 5. å®éªŒè¿‡ç¨‹

- **ä½äº¤äº’å‹èœœç½æ­å»º** ğŸ‘‰ SSH Honeypot

    ```
    # å®‰è£…ä¾èµ–è½¯ä»¶
    apt-get install libssh-dev libjson-c-dev
    # å°†ä»£ç ä»“åº“å…‹éš†åˆ°æœ¬åœ°
    git clone https://github.com/droberson/ssh-honeypot.git
    # åˆ‡æ¢å·¥ä½œç›®å½•
    cd ssh-honeypot
    # æ­å»ºè½¯ä»¶è¿è¡Œç¯å¢ƒ
    make
    # ç”Ÿæˆä¸€å¯¹å…¬ç§é’¥
    ssh-keygen -t rsa -f ./ssh-honeypot.rsa
    # æ­å»ºé•œåƒï¼Œæ„é€ èœœç½ç¯å¢ƒ
    cd docker
    docker build .
    # è¿è¡Œå®¹å™¨
    docker-compose -p ssh-honeypot up
    ```

    ![img](img/ssh-honeypot-image.PNG)

    ![img](img/ssh-honeypot-container.PNG)

    ![img](img/ssh-honeypot-run.PNG)


- **ä¸­ç­‰äº¤äº’å‹èœœç½æ­å»º** ğŸ‘‰Cowrie

    ```
    # æ‹‰å–crowieé•œåƒ
    docker pull cowrie/cowrie
    # å¯åŠ¨å®¹å™¨
    docker run -p 2222:2222 cowrie/cowrie
    ```

    ![img](img/cowrie-pull.PNG)

    - æ™®é€šç”¨æˆ·

        ![img](img/cowrie-ssh-ord.PNG)

        ![img](img/cowrie-ssh-connect-ord.PNG)

    - root

        ![img](img/cowrie-ssh-root.PNG)

        ![img](img/cowrie-ssh-connect-root.PNG)



- **åŸºäºnmapçš„èœœç½æ‰«æ**

    ```
    # å¯¹host-1è¿›è¡Œæš´åŠ›æ‰«æ
    nmap 192.168.56.119 -A -T4 -n -vv
    ```

    - **SSH Honeypot**
    
        æœ¬åœ°æ—¥å¿—ä¸­æœªå‡ºç°ç›¸å…³è®°å½•

        ![img](img/ssh-honeypot-nmap.PNG)

    - **Cowrie**

        - host-1ç»ˆç«¯è¾“å‡ºå¯ç–‘æ”»å‡»ç›®æ ‡çš„IPã€æ‰«ææ–¹å¼ã€æ‰«æå¯¹è±¡ã€ä½¿ç”¨ç«¯å£ç­‰ä¿¡æ¯

        - æ—¥å¿—ä¸­è®°å½•äº†æ”»å‡»è€…è¡Œä¸º

        ![img](img/cowrie-nmap.PNG)

- **èœœç½è¯†åˆ«ä¸æ£€æµ‹**

    - å¸¸è§çš„èœœç½è¯†åˆ«å’Œæ£€æµ‹æ–¹æ³•æ€»ç»“

        - é¶æœºè¿‡â€œæ–°â€ï¼Œå¼•è¯±ç›®çš„è¿‡äºæ˜æ˜¾

            ã€ä¾‹ã€‘æ–‡ä»¶å/æ–‡ä»¶å¤¹åè®¾ç½®ä¸ºsensitiveï¼Œå¹¶æ”¾åœ¨å¾ˆå®¹æ˜“å‘ç°çš„åœ°æ–¹

        - ç¡¬ä»¶ä¿¡æ¯å‡ºç°å¼‚å¸¸

            ã€ä¾‹ã€‘é¼ æ ‡é©±åŠ¨ç¨‹åºçš„åˆ¶é€ å•†æ ‡è®°ä¸ºâ€œ Microsoft SMSè§£å†³æ–¹æ¡ˆâ€ï¼›CPUIDæ“ä½œç å°†EAXçš„å€¼ç½®ä¸º0x02

        - åˆ›å»ºä¸ç¬¦åˆå®é™…æƒ…å†µçš„é…ç½®ï¼Œä½†æœºå™¨ä»ç„¶å¯ä»¥æ­£å¸¸è¿è¡Œ

            ã€ä¾‹ã€‘åŒæ—¶è¿è¡ŒWindows web serverä¸Unix FTP server

        - äº‰å¤ºèµ„æºåèœœç½æœºä¼šæ˜æ˜¾å˜æ…¢

            ã€ä¾‹ã€‘å¯åŠ¨ä¸€ä¸ªCPUå¯†é›†å‹è¿›ç¨‹ï¼›ping flood

        - æ ¹æ®ç›´æ¥åæ˜ åŸºç¡€æœåŠ¡å™¨çŠ¶æ€çš„ä¿¡æ¯è¿›è¡Œåˆ¤æ–­
            ã€ä¾‹ã€‘TCPæ—¶é—´æˆ³æ— å§‹ç»ˆåå·®

        - ç½‘ç»œä¿¡æ¯äº¤äº’ä¸­çš„å¼‚å¸¸è¡Œä¸ºï¼ˆé€šå¸¸ç”±äºè½¯ä»¶ç¼–å†™é”™è¯¯ï¼‰

            ã€ä¾‹ã€‘ç”±äºHoneydå¤„ç†NMAPæŒ‡çº¹ä¿¡æ¯çš„é”™è¯¯å¯¼è‡´äº†å®ƒåœ¨å›å¤TCPæ•°æ®åŒ…æ—¶åŒæ—¶è®¾ç½®äº†SYNå’ŒRSTæ ‡å¿—

        - å¯ç–‘çš„å¼€æ”¾ç½‘ç»œç«¯å£/ç½‘ç»œç«¯å£ç»„åˆ

            ã€ä¾‹ã€‘Kuang2ç•™ä¸‹çš„åé—¨ç«¯å£ä¸ºTCP-17300ï¼ˆä¸å¸¸è§ç«¯å£ï¼‰

        - ä½¿ç”¨èœœç½æ£€æµ‹å·¥å…·

    - èœœç½è¯†åˆ«ä¸æ£€æµ‹å®æ“

        **ã€æ³¨ã€‘** ç”±äºå­˜åœ¨çš„é—®é¢˜å¾ˆå¤šï¼Œå› æ­¤è¿™é‡Œä¸è¿›è¡Œç©·ä¸¾

        - ä½äº¤äº’å‹èœœç½ï¼šæ— æ³•ä½¿ç”¨SSHè¿œç¨‹ç™»é™†

        - ä¸­ç­‰äº¤äº’å‹èœœç½ ğŸ‘‰ ä»¥Cowrieä¸ºä¾‹

            1. ä½¿ç”¨rootä¸ä»»æ„å¯†ç å³å¯å®ç°ç™»å½•

            2. ä½¿ç”¨sshè¿œç¨‹ç™»é™†æœ‰æ—¶é™é™åˆ¶

                ![img](img/cowrie-timing.PNG)

            3. åœ¨èœœç½ä¸­å¯¹è‡ªå·±çš„IPå®æ–½ping flood

                ![img](img/cowrie-ping.PNG)

                ![img](img/cowrie-ping-attack.PNG)

            4. è½¯ä»¶å®‰è£…è¡Œä¸ºå¼‚å¸¸

                ![img](img/cowrie-apt.PNG)
                
                ä»¥ä¸‹æ˜¯åœ¨è™šæ‹Ÿæœºä¸­æ“ä½œçš„æ­£å¸¸ç‰ˆæœ¬ï¼š

                ![img](img/cowrie-apt-normal.PNG)

            5. è½¯ä»¶è¡Œä¸ºæ¨¡æ‹Ÿå¼‚å¸¸

                ![img](img/cowrie-software.PNG)

            6. æ“ä½œæƒé™å¼‚å¸¸

                ![img](img/cowrie-priv.PNG)

            7. ç”¨æˆ·åˆ‡æ¢æ“ä½œæ— æ•ˆ

                ![img](img/cowrie-su.PNG)
            
            8. IPåœ°å€ä¸sshè¿æ¥æ—¶ä½¿ç”¨çš„IPï¼ˆ192.168.56.119ï¼‰æ— æ³•å¯¹åº”

                ![img](img/cowrie-network.PNG)

            9. æ–‡ä»¶æ“ä½œå¼‚å¸¸

                ![img](img/cowrie-file.PNG)

### 6. é‡åˆ°çš„é—®é¢˜

- SSH Honeyå®¹å™¨å¯åŠ¨å¤±è´¥

    **é”™è¯¯åŸå› ï¼š** sshdé»˜è®¤åœ¨22ç«¯å£è¿è¡Œ

    **è§£å†³æ–¹æ³•ï¼š** ç¼–è¾‘sshdçš„é…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹è¿è¡Œç«¯å£

    /etc/ssh/sshd_config
    
    ```
    Port unused_port_num
    ```

- **ã€Unsolvedã€‘** SSH HoneyæœåŠ¡æˆåŠŸå¯åŠ¨ï¼Œhost-2ä¹Ÿå¯ä»¥ä¸host-1è¿›è¡Œsshè¿æ¥ï¼Œä½†SSH Honeyçš„æ—¥å¿—ä¸­æ— SSHè¿æ¥çš„è®°å½•

### 7. å‚è€ƒèµ„æ–™

- [ã€Low Interactionã€‘droberson/ssh-honeypot - GitHub](https://github.com/droberson/ssh-honeypot)

- [Using "make" and writing Makefiles](https://www.cs.oberlin.edu/~kuperman/help/make.html)

- [SSH Honeypot Docker](https://github.com/droberson/ssh-honeypot/blob/master/docker/README.md)

- [OCI runtime exec failed: exec failed: ...executable file not found in $PATH": unknown](https://stackoverflow.com/questions/48001082/oci-runtime-exec-failed-exec-failed-executable-file-not-found-in-path)

- [Brief Experiment With SSH Honeypots](https://dmfrsecurity.com/2016/12/29/brief-experiment-with-ssh-honeypots/)

- [9. Detecting Honeypots](http://books.gigatux.nl/mirror/honeypot/final/ch09.html)

- [è§£å†³unknown import path "golang.org/x/sys/unix": unrecognized import path "golang.org/x/sys"](https://www.cnblogs.com/sage-blog/p/10640947.html)

- [Is it possible to detect a honeypot? [closed]](https://security.stackexchange.com/questions/90642/is-it-possible-to-detect-a-honeypot)